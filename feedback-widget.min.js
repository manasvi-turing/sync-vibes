!function(n){"use strict";const e={version:"1.0.0",feedbacks:[],config:{storageKey:"feedback_widget_data",showButton:!0,buttonPosition:"bottom-right",theme:"light",maxCommentLength:500},isActive:!1,currentBox:null,isDrawing:!1,drawStartX:0,drawStartY:0,currentDrawBox:null,markersVisible:!0,init:function(n={}){this.config={...this.config,...n};const e=localStorage.getItem("feedback_markers_visible");return null!==e&&(this.markersVisible="true"===e),this.loadFeedbacks(),this.injectStyles(),this.config.showButton&&this.createToggleButton(),this.setupEventListeners(),this.setupRouteChangeListeners(),this.checkScrollToAnnotation(),this},checkScrollToAnnotation:function(){const n=sessionStorage.getItem("fb_scroll_to_id");n&&(sessionStorage.removeItem("fb_scroll_to_id"),setTimeout(()=>{const e=this.feedbacks.find(e=>e.id===n);e&&this.scrollToAnnotation(e)},500))},injectStyles:function(){if(document.getElementById("feedback-widget-styles"))return;if(!document.getElementById("google-material-symbols")){const n=document.createElement("link");n.id="google-material-symbols",n.rel="stylesheet",n.href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200",document.head.appendChild(n)}const n=document.createElement("style");n.id="feedback-widget-styles",n.textContent="\n        .fb-widget-container {\n          position: fixed;\n          z-index: 999999;\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n          background: white;\n          padding: 12px;\n          border-radius: 12px;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        \n        .fb-widget-container:hover {\n          box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);\n          transform: translateY(-4px) scale(1.03);\n        }\n        \n        .fb-widget-container.bottom-right { bottom: 20px; right: 20px; }\n        .fb-widget-container.bottom-left { bottom: 20px; left: 20px; }\n        .fb-widget-container.top-right { top: 20px; right: 20px; }\n        .fb-widget-container.top-left { top: 20px; left: 20px; }\n        \n        .fb-button-row {\n          display: grid;\n          grid-template-columns: 1fr auto;\n          gap: 8px;\n          align-items: center;\n        }\n        \n        .fb-widget-button {\n          padding: 10px 14px;\n          background: #4F46E5;\n          color: white;\n          border: none;\n          border-radius: 8px;\n          cursor: pointer;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          font-size: 14px;\n          font-weight: 500;\n          box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n          transition: all 0.2s;\n          display: inline-flex;\n          align-items: center;\n          justify-content: center;\n          gap: 6px;\n          white-space: nowrap;\n        }\n        \n        .fb-widget-button span:not(.material-symbols-outlined) {\n          min-width: 70px;\n          text-align: center;\n        }\n        \n        .fb-widget-button .material-symbols-outlined {\n          font-size: 20px;\n        }\n        \n        .fb-widget-button:hover {\n          background: #4338CA;\n          transform: translateY(-2px);\n          box-shadow: 0 6px 12px rgba(0,0,0,0.15);\n        }\n        \n        .fb-widget-button.active {\n          background: #DC2626;\n        }\n        \n        .fb-toggle-markers-btn {\n          min-width: 44px;\n          padding: 10px;\n          justify-content: center;\n        }\n        \n        .fb-stats-bar {\n          display: flex;\n          gap: 8px;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n        }\n        \n        .fb-stat-item {\n          flex: 1;\n          padding: 8px;\n          background: rgba(255, 255, 255, 0.95);\n          border: 1px solid #E5E7EB;\n          border-radius: 6px;\n          text-align: center;\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n        }\n        \n        .fb-stat-number {\n          color: #4F46E5;\n          font-weight: 700;\n          font-size: 18px;\n          line-height: 1;\n        }\n        \n        .fb-stat-label {\n          color: #6B7280;\n          font-size: 10px;\n          font-weight: 500;\n          text-transform: uppercase;\n          letter-spacing: 0.3px;\n          line-height: 1;\n        }\n        \n        .fb-stat-item:hover {\n          background: #F3F4F6;\n          cursor: pointer;\n          transform: translateY(-1px);\n        }\n        \n        .fb-modal-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: rgba(0, 0, 0, 0.5);\n          z-index: 1000000;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          backdrop-filter: blur(4px);\n        }\n        \n        .fb-modal {\n          background: white;\n          border-radius: 16px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          max-width: 600px;\n          max-height: 80vh;\n          width: 90%;\n          display: flex;\n          flex-direction: column;\n        }\n        \n        .fb-modal-header {\n          padding: 20px 24px;\n          border-bottom: 1px solid #E5E7EB;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n        \n        .fb-modal-title {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          font-size: 18px;\n          font-weight: 600;\n          color: #111827;\n        }\n        \n        .fb-modal-close {\n          background: none;\n          border: none;\n          cursor: pointer;\n          padding: 4px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: #6B7280;\n          transition: all 0.2s;\n          border-radius: 6px;\n        }\n        \n        .fb-modal-close:hover {\n          background: #F3F4F6;\n          color: #111827;\n        }\n        \n        .fb-modal-body {\n          padding: 16px 24px 24px;\n          overflow-y: auto;\n          flex: 1;\n        }\n        \n        .fb-annotation-item {\n          padding: 16px;\n          border: 1px solid #E5E7EB;\n          border-radius: 10px;\n          margin-bottom: 12px;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n        \n        .fb-annotation-item:hover {\n          border-color: #4F46E5;\n          box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);\n          transform: translateY(-2px);\n        }\n        \n        .fb-annotation-header {\n          display: flex;\n          align-items: flex-start;\n          gap: 8px;\n          margin-bottom: 10px;\n        }\n        \n        .fb-annotation-icon {\n          color: #4F46E5;\n          font-size: 20px;\n          flex-shrink: 0;\n        }\n        \n        .fb-annotation-meta {\n          flex: 1;\n        }\n        \n        .fb-annotation-page {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          font-size: 13px;\n          font-weight: 600;\n          color: #4F46E5;\n          margin-bottom: 4px;\n          word-break: break-all;\n        }\n        \n        .fb-annotation-location {\n          font-family: 'Monaco', 'Courier New', monospace;\n          font-size: 11px;\n          color: #6B7280;\n          word-break: break-all;\n        }\n        \n        .fb-annotation-comment {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          font-size: 14px;\n          color: #374151;\n          line-height: 1.5;\n          padding-left: 28px;\n        }\n        \n        .fb-empty-state {\n          text-align: center;\n          padding: 40px 20px;\n          color: #9CA3AF;\n        }\n        \n        .fb-empty-state .material-symbols-outlined {\n          font-size: 48px;\n          margin-bottom: 12px;\n          opacity: 0.5;\n        }\n        \n        @keyframes pulse {\n          0%, 100% { transform: scale(1); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }\n          50% { transform: scale(1.1); box-shadow: 0 8px 24px rgba(79, 70, 229, 0.6); }\n        }\n        \n        .fb-feedback-marker {\n          position: absolute;\n          border: 3px solid #4F46E5;\n          background: rgba(79, 70, 229, 0.1);\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);\n          z-index: 999998;\n          transition: all 0.2s;\n          pointer-events: auto;\n        }\n        \n        .fb-feedback-marker:hover {\n          background: rgba(79, 70, 229, 0.15);\n          box-shadow: 0 6px 16px rgba(79, 70, 229, 0.5);\n          border-color: #4338CA;\n        }\n        \n        .fb-feedback-marker-label {\n          position: absolute;\n          top: -12px;\n          left: -12px;\n          min-width: 28px;\n          height: 28px;\n          padding: 0 8px;\n          background: #4F46E5;\n          color: white;\n          border: 2px solid white;\n          border-radius: 6px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 13px;\n          font-weight: bold;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n        }\n        \n        .fb-feedback-marker-label::before {\n          content: '#';\n          margin-right: 2px;\n          opacity: 0.9;\n        }\n        \n        .fb-drawing-box {\n          position: absolute;\n          border: 2px dashed #4F46E5;\n          background: rgba(79, 70, 229, 0.08);\n          z-index: 999999;\n          pointer-events: none;\n        }\n        \n        .fb-feedback-box {\n          position: fixed;\n          z-index: 1000000;\n          background: white;\n          border-radius: 12px;\n          box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n          padding: 20px;\n          width: 320px;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          animation: fb-slide-in 0.3s ease-out;\n        }\n        \n        @keyframes fb-slide-in {\n          from { opacity: 0; transform: translateY(10px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        \n        .fb-feedback-box-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 16px;\n        }\n        \n        .fb-feedback-box-title {\n          font-size: 16px;\n          font-weight: 600;\n          color: #1F2937;\n        }\n        \n        .fb-feedback-box-close {\n          background: none;\n          border: none;\n          font-size: 24px;\n          cursor: pointer;\n          color: #6B7280;\n          padding: 0;\n          width: 24px;\n          height: 24px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        \n        .fb-feedback-textarea {\n          width: 100%;\n          min-height: 100px;\n          padding: 12px;\n          border: 1px solid #D1D5DB;\n          border-radius: 8px;\n          font-family: inherit;\n          font-size: 14px;\n          resize: vertical;\n          box-sizing: border-box;\n        }\n        \n        .fb-feedback-textarea:focus {\n          outline: none;\n          border-color: #4F46E5;\n          box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);\n        }\n        \n        .fb-feedback-actions {\n          display: flex;\n          gap: 8px;\n          margin-top: 12px;\n        }\n        \n        .fb-feedback-btn {\n          flex: 1;\n          padding: 10px;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n        \n        .fb-feedback-btn-primary {\n          background: #4F46E5;\n          color: white;\n        }\n        \n        .fb-feedback-btn-primary:hover {\n          background: #4338CA;\n        }\n        \n        .fb-feedback-btn-secondary {\n          background: #F3F4F6;\n          color: #374151;\n        }\n        \n        .fb-feedback-btn-secondary:hover {\n          background: #E5E7EB;\n        }\n        \n        .fb-feedback-list {\n          position: fixed;\n          right: 20px;\n          top: 20px;\n          z-index: 999997;\n          background: white;\n          border-radius: 12px;\n          box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n          padding: 16px;\n          width: 280px;\n          max-height: 400px;\n          overflow-y: auto;\n        }\n        \n        .fb-feedback-item {\n          padding: 12px;\n          background: #F9FAFB;\n          border-radius: 8px;\n          margin-bottom: 8px;\n          font-size: 13px;\n        }\n        \n        .fb-feedback-item-text {\n          color: #374151;\n          margin-bottom: 4px;\n        }\n        \n        .fb-feedback-item-meta {\n          color: #9CA3AF;\n          font-size: 11px;\n        }\n      ",document.head.appendChild(n)},createToggleButton:function(){const n=document.createElement("div");n.className=`fb-widget-container ${this.config.buttonPosition}`;const e=document.createElement("div");e.className="fb-button-row";const t=document.createElement("button");t.className="fb-widget-button",t.innerHTML='<span class="material-symbols-outlined">chat</span><span>SyncVibes</span>',t.onclick=()=>this.toggleMode(),e.appendChild(t),this.toggleButton=t;const a=document.createElement("button");a.className="fb-widget-button fb-toggle-markers-btn",a.innerHTML=this.markersVisible?'<span class="material-symbols-outlined">visibility</span>':'<span class="material-symbols-outlined">visibility_off</span>',a.title=this.markersVisible?"Hide markers":"Show markers",a.onclick=()=>this.toggleMarkers(),e.appendChild(a),this.toggleMarkersButton=a,n.appendChild(e);const o=document.createElement("div");o.className="fb-stats-bar",o.innerHTML='\n        <div class="fb-stat-item">\n          <div class="fb-stat-number" id="fb-stat-page">0</div>\n          <div class="fb-stat-label">This Page</div>\n        </div>\n        <div class="fb-stat-item">\n          <div class="fb-stat-number" id="fb-stat-total">0</div>\n          <div class="fb-stat-label">Total</div>\n        </div>\n      ',n.appendChild(o),this.statsBar=o;const i=o.children[0],s=o.children[1];i.addEventListener("click",()=>{this.openAnnotationsModal("page")}),s.addEventListener("click",()=>{this.openAnnotationsModal("total")}),document.body.appendChild(n),this.widgetContainer=n,this.updateStats()},toggleMode:function(){if(this.isActive=!this.isActive,this.toggleButton.classList.toggle("active",this.isActive),this.toggleButton.innerHTML=this.isActive?'<span class="material-symbols-outlined">close</span><span>Close</span>':'<span class="material-symbols-outlined">chat</span><span>SyncVibes</span>',this.isActive&&!this.markersVisible){this.markersVisible=!0;document.querySelectorAll(".fb-feedback-marker").forEach(n=>{n.style.display="block"}),this.toggleMarkersButton.innerHTML='<span class="material-symbols-outlined">visibility</span>',this.toggleMarkersButton.title="Hide markers",localStorage.setItem("feedback_markers_visible","true")}this.isActive?(document.body.style.cursor="crosshair",document.body.style.userSelect="none"):(document.body.style.cursor="",document.body.style.userSelect=""),!this.isActive&&this.currentBox&&this.closeCurrentBox()},toggleMarkers:function(){this.markersVisible=!this.markersVisible;document.querySelectorAll(".fb-feedback-marker").forEach(n=>{n.style.display=this.markersVisible?"block":"none"}),this.toggleMarkersButton.innerHTML=this.markersVisible?'<span class="material-symbols-outlined">visibility</span>':'<span class="material-symbols-outlined">visibility_off</span>',this.toggleMarkersButton.title=this.markersVisible?"Hide markers":"Show markers",localStorage.setItem("feedback_markers_visible",this.markersVisible.toString())},updateStats:function(){const e=document.getElementById("fb-stat-page"),t=document.getElementById("fb-stat-total");if(!e||!t)return;const a=this.feedbacks.length,o=n.location.href,i=n.location.pathname,s=n.location.hash,r=this.feedbacks.filter(e=>{try{const t=new URL(e.url,n.location.origin);return e.url===o||(t.pathname===i&&t.hash===s||t.pathname===i&&!s&&!t.hash)}catch(n){return e.pathname===i}}).length;e.textContent=r,t.textContent=a},openAnnotationsModal:function(e){const t=n.location.href,a=n.location.pathname,o=n.location.hash;let i=[];i="page"===e?this.feedbacks.filter(e=>{try{const i=new URL(e.url,n.location.origin);return e.url===t||(i.pathname===a&&i.hash===o||i.pathname===a&&!o&&!i.hash)}catch(n){return e.pathname===a}}):this.feedbacks;const s=document.createElement("div");s.className="fb-modal-overlay";const r=document.createElement("div");r.className="fb-modal";const l=document.createElement("div");l.className="fb-modal-header";const c=document.createElement("div");c.className="fb-modal-title",c.innerHTML=`<span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 8px;">bookmark</span>${"page"===e?"This Page":"All"} Annotations (${i.length})`;const d=document.createElement("button");d.className="fb-modal-close",d.innerHTML='<span class="material-symbols-outlined">close</span>',d.title="Close",l.appendChild(c),l.appendChild(d);const b=document.createElement("div");b.className="fb-modal-body",0===i.length?b.innerHTML='\n          <div class="fb-empty-state">\n            <span class="material-symbols-outlined">sentiment_satisfied</span>\n            <div>No annotations yet</div>\n          </div>\n        ':i.forEach(e=>{const t=document.createElement("div");t.className="fb-annotation-item";let a="Unknown",o="";try{const t=new URL(e.url,n.location.origin);a=t.pathname,o=t.hash}catch(n){a=e.pathname||"Unknown"}t.innerHTML=`\n            <div class="fb-annotation-header">\n              <span class="material-symbols-outlined fb-annotation-icon">location_on</span>\n              <div class="fb-annotation-meta">\n                <div class="fb-annotation-page">${a}</div>\n                <div class="fb-annotation-location">${o||"Top of page"} • (${e.x}, ${e.y})</div>\n              </div>\n            </div>\n            <div class="fb-annotation-comment">${e.comment}</div>\n          `,t.addEventListener("click",()=>{this.navigateToAnnotation(e),this.closeModal(s)}),b.appendChild(t)}),r.appendChild(l),r.appendChild(b),s.appendChild(r),d.addEventListener("click",()=>this.closeModal(s)),s.addEventListener("click",n=>{n.target===s&&this.closeModal(s)}),document.body.appendChild(s)},closeModal:function(n){n.remove()},navigateToAnnotation:function(e){const t=n.location.href;e.url!==t?(sessionStorage.setItem("fb_scroll_to_id",e.id),n.location.href=e.url):this.scrollToAnnotation(e)},scrollToAnnotation:function(e){const t=document.querySelector(`[data-feedback-id="${e.id}"]`);t?(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.animation="none",setTimeout(()=>{t.style.animation="pulse 1s ease-in-out 3"},10)):n.scrollTo({top:e.position.pageY-n.innerHeight/2,left:e.position.pageX-n.innerWidth/2,behavior:"smooth"})},setupEventListeners:function(){document.addEventListener("selectstart",n=>{this.isActive&&n.preventDefault()}),document.addEventListener("mousemove",n=>{this.isActive?(document.body.style.cursor="crosshair",document.body.style.userSelect="none",this.isDrawing&&this.currentDrawBox&&this.updateDrawingBox(n.pageX,n.pageY)):(document.body.style.cursor="",document.body.style.userSelect="")}),document.addEventListener("mousedown",n=>{this.isActive&&(n.target.closest(".fb-widget-button")||n.target.closest(".fb-feedback-box")||n.target.closest(".fb-feedback-marker")||(n.preventDefault(),n.stopPropagation(),this.startDrawing(n.pageX,n.pageY)))},!0),document.addEventListener("mouseup",n=>{this.isActive&&this.isDrawing&&(n.preventDefault(),n.stopPropagation(),this.finishDrawing(n.pageX,n.pageY))},!0)},setupRouteChangeListeners:function(){n.addEventListener("popstate",()=>{this.handleRouteChange()});const e=history.pushState,t=history.replaceState,a=this;history.pushState=function(){e.apply(this,arguments),a.handleRouteChange()},history.replaceState=function(){t.apply(this,arguments),a.handleRouteChange()},n.addEventListener("hashchange",()=>{this.handleRouteChange()})},handleRouteChange:function(){console.log("Route changed to:",n.location.pathname),this.displayMarkersForCurrentPage(),this.currentBox&&this.closeCurrentBox(),this.currentDrawBox&&(this.currentDrawBox.remove(),this.currentDrawBox=null),this.isActive&&(this.isActive=!1,this.toggleButton.classList.remove("active"),this.toggleButton.textContent="💬 Feedback",document.body.style.cursor="",document.body.style.userSelect="")},startDrawing:function(n,e){this.isDrawing=!0,this.drawStartX=n,this.drawStartY=e;const t=document.createElement("div");t.className="fb-drawing-box",t.style.left=`${n}px`,t.style.top=`${e}px`,t.style.width="0px",t.style.height="0px",document.body.appendChild(t),this.currentDrawBox=t},updateDrawingBox:function(n,e){if(!this.currentDrawBox)return;const t=Math.min(this.drawStartX,n),a=Math.min(this.drawStartY,e),o=Math.abs(n-this.drawStartX),i=Math.abs(e-this.drawStartY);this.currentDrawBox.style.left=`${t}px`,this.currentDrawBox.style.top=`${a}px`,this.currentDrawBox.style.width=`${o}px`,this.currentDrawBox.style.height=`${i}px`},finishDrawing:function(n,e){this.isDrawing=!1;const t=Math.min(this.drawStartX,n),a=Math.min(this.drawStartY,e),o=Math.abs(n-this.drawStartX),i=Math.abs(e-this.drawStartY);if(o<10||i<10)return this.currentDrawBox&&(this.currentDrawBox.remove(),this.currentDrawBox=null),void this.createFeedbackBox(this.drawStartX,this.drawStartY,100,100);this.createFeedbackBox(t,a,o,i)},createFeedbackBox:function(e,t,a,o){const i=document.createElement("div");i.className="fb-feedback-box",i.style.left=`${Math.min(e+a+10,n.innerWidth-340)}px`,i.style.top=`${Math.min(t,n.innerHeight-250)}px`,i.innerHTML=`\n        <div class="fb-feedback-box-header">\n          <div class="fb-feedback-box-title">Add Feedback</div>\n          <button class="fb-feedback-box-close">×</button>\n        </div>\n        <textarea \n          class="fb-feedback-textarea" \n          placeholder="What's on your mind?"\n          maxlength="${this.config.maxCommentLength}"\n        ></textarea>\n        <div class="fb-feedback-actions">\n          <button class="fb-feedback-btn fb-feedback-btn-secondary">Cancel</button>\n          <button class="fb-feedback-btn fb-feedback-btn-primary">Save</button>\n        </div>\n      `,document.body.appendChild(i),this.currentBox={element:i,x:e,y:t,width:a,height:o};const s=i.querySelector(".fb-feedback-textarea");s.focus(),i.querySelector(".fb-feedback-box-close").onclick=()=>this.cancelFeedback(),i.querySelector(".fb-feedback-btn-secondary").onclick=()=>this.cancelFeedback(),i.querySelector(".fb-feedback-btn-primary").onclick=()=>this.saveFeedback(s.value,e,t,a,o)},cancelFeedback:function(){this.closeCurrentBox(),this.currentDrawBox&&(this.currentDrawBox.remove(),this.currentDrawBox=null)},saveFeedback:function(e,t,a,o,i){if(!e.trim())return void alert("Please enter a comment");const s={id:this.generateId(),comment:e.trim(),position:{x:t,y:a,width:o,height:i,pageX:t,pageY:a,viewportWidth:n.innerWidth,viewportHeight:n.innerHeight,scrollX:n.scrollX,scrollY:n.scrollY},url:n.location.href,pathname:n.location.pathname,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,screenSize:{width:n.screen.width,height:n.screen.height}};this.feedbacks.push(s),this.saveFeedbacks(),this.currentDrawBox&&(this.currentDrawBox.remove(),this.currentDrawBox=null),this.createMarker(s),this.closeCurrentBox(),this.updateStats(),console.log("Feedback saved:",s)},createMarker:function(n){const e=document.createElement("div");e.className="fb-feedback-marker";const t=this.feedbacks.indexOf(n)+1;e.style.left=`${n.position.pageX}px`,e.style.top=`${n.position.pageY}px`,e.style.width=`${n.position.width}px`,e.style.height=`${n.position.height}px`,e.style.display=this.markersVisible?"block":"none",e.title=n.comment,e.dataset.feedbackId=n.id;const a=document.createElement("div");a.className="fb-feedback-marker-label",a.textContent=t,e.appendChild(a),e.onclick=e=>{e.stopPropagation(),this.showFeedback(n)},document.body.appendChild(e),console.log("Created marker #"+t+" at:",{left:e.style.left,top:e.style.top,width:e.style.width,height:e.style.height})},showFeedback:function(n){alert(`Feedback #${n.id}\n\n${n.comment}\n\nTime: ${new Date(n.timestamp).toLocaleString()}`)},closeCurrentBox:function(){this.currentBox&&(this.currentBox.element.remove(),this.currentBox=null)},saveFeedbacks:function(){try{localStorage.setItem(this.config.storageKey,JSON.stringify(this.feedbacks))}catch(n){console.error("Failed to save feedbacks:",n)}},loadFeedbacks:function(){try{const n=localStorage.getItem(this.config.storageKey);n&&(this.feedbacks=JSON.parse(n),this.displayMarkersForCurrentPage())}catch(n){console.error("Failed to load feedbacks:",n)}},displayMarkersForCurrentPage:function(){this.clearMarkers();const e=n.location.href,t=n.location.pathname,a=n.location.hash,o=this.feedbacks.filter(o=>{try{const i=new URL(o.url,n.location.origin);return o.url===e||(i.pathname===t&&i.hash===a||i.pathname===t&&!a&&!i.hash)}catch(n){return o.pathname===t}});o.forEach(n=>this.createMarker(n)),this.updateStats(),console.log(`Displayed ${o.length} markers for ${t}${a}`)},clearMarkers:function(){document.querySelectorAll(".fb-feedback-marker").forEach(n=>n.remove())},exportFeedbacks:function(){return JSON.parse(JSON.stringify(this.feedbacks))},importFeedbacks:function(n){this.feedbacks=n,this.saveFeedbacks(),this.displayMarkersForCurrentPage()},clearFeedbacks:function(){confirm("Clear all feedbacks?")&&(this.feedbacks=[],this.saveFeedbacks(),this.clearMarkers(),this.updateStats())},generateId:function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}};n.FeedbackWidget=e}(window);