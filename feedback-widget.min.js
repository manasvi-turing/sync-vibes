/**
 * FeedbackWidget - Ultra-lightweight feedback capture library
 * @version 1.0.0
 * @license MIT
 * 
 * Usage:
 *   <script src="https://cdn.jsdelivr.net/gh/[username]/[repo]/feedback-widget.min.js"><\/script>
 *   <script>FeedbackWidget.init();</script>
 */
!function(e){"use strict";const t={version:"1.0.0",feedbacks:[],config:{storageKey:"feedback_widget_data",showButton:!0,buttonPosition:"bottom-right",theme:"light",maxCommentLength:500},isActive:!1,currentBox:null,isDrawing:!1,drawStartX:0,drawStartY:0,currentDrawBox:null,init:function(e={}){return this.config={...this.config,...e},this.loadFeedbacks(),this.injectStyles(),this.config.showButton&&this.createToggleButton(),this.setupEventListeners(),this},injectStyles:function(){if(document.getElementById("feedback-widget-styles"))return;const e=document.createElement("style");e.id="feedback-widget-styles",e.textContent="\n        .fb-widget-button {\n          position: fixed;\n          z-index: 999999;\n          padding: 12px 20px;\n          background: #4F46E5;\n          color: white;\n          border: none;\n          border-radius: 8px;\n          cursor: pointer;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          font-size: 14px;\n          font-weight: 500;\n          box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n          transition: all 0.2s;\n        }\n        \n        .fb-widget-button:hover {\n          background: #4338CA;\n          transform: translateY(-2px);\n          box-shadow: 0 6px 12px rgba(0,0,0,0.15);\n        }\n        \n        .fb-widget-button.active {\n          background: #DC2626;\n        }\n        \n        .fb-widget-button.bottom-right { bottom: 20px; right: 20px; }\n        .fb-widget-button.bottom-left { bottom: 20px; left: 20px; }\n        .fb-widget-button.top-right { top: 20px; right: 20px; }\n        .fb-widget-button.top-left { top: 20px; left: 20px; }\n        \n        .fb-feedback-marker {\n          position: absolute;\n          border: 3px solid #4F46E5;\n          background: rgba(79, 70, 229, 0.1);\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);\n          z-index: 999998;\n          transition: all 0.2s;\n          pointer-events: auto;\n        }\n        \n        .fb-feedback-marker:hover {\n          background: rgba(79, 70, 229, 0.15);\n          box-shadow: 0 6px 16px rgba(79, 70, 229, 0.5);\n          border-color: #4338CA;\n        }\n        \n        .fb-feedback-marker-label {\n          position: absolute;\n          top: -12px;\n          left: -12px;\n          min-width: 28px;\n          height: 28px;\n          padding: 0 8px;\n          background: #4F46E5;\n          color: white;\n          border: 2px solid white;\n          border-radius: 6px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 13px;\n          font-weight: bold;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n        }\n        \n        .fb-feedback-marker-label::before {\n          content: '#';\n          margin-right: 2px;\n          opacity: 0.9;\n        }\n        \n        .fb-drawing-box {\n          position: absolute;\n          border: 2px dashed #4F46E5;\n          background: rgba(79, 70, 229, 0.08);\n          z-index: 999999;\n          pointer-events: none;\n        }\n        \n        .fb-feedback-box {\n          position: fixed;\n          z-index: 1000000;\n          background: white;\n          border-radius: 12px;\n          box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n          padding: 20px;\n          width: 320px;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n          animation: fb-slide-in 0.3s ease-out;\n        }\n        \n        @keyframes fb-slide-in {\n          from { opacity: 0; transform: translateY(10px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        \n        .fb-feedback-box-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 16px;\n        }\n        \n        .fb-feedback-box-title {\n          font-size: 16px;\n          font-weight: 600;\n          color: #1F2937;\n        }\n        \n        .fb-feedback-box-close {\n          background: none;\n          border: none;\n          font-size: 24px;\n          cursor: pointer;\n          color: #6B7280;\n          padding: 0;\n          width: 24px;\n          height: 24px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        \n        .fb-feedback-textarea {\n          width: 100%;\n          min-height: 100px;\n          padding: 12px;\n          border: 1px solid #D1D5DB;\n          border-radius: 8px;\n          font-family: inherit;\n          font-size: 14px;\n          resize: vertical;\n          box-sizing: border-box;\n        }\n        \n        .fb-feedback-textarea:focus {\n          outline: none;\n          border-color: #4F46E5;\n          box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);\n        }\n        \n        .fb-feedback-actions {\n          display: flex;\n          gap: 8px;\n          margin-top: 12px;\n        }\n        \n        .fb-feedback-btn {\n          flex: 1;\n          padding: 10px;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n        \n        .fb-feedback-btn-primary {\n          background: #4F46E5;\n          color: white;\n        }\n        \n        .fb-feedback-btn-primary:hover {\n          background: #4338CA;\n        }\n        \n        .fb-feedback-btn-secondary {\n          background: #F3F4F6;\n          color: #374151;\n        }\n        \n        .fb-feedback-btn-secondary:hover {\n          background: #E5E7EB;\n        }\n        \n        .fb-feedback-list {\n          position: fixed;\n          right: 20px;\n          top: 20px;\n          z-index: 999997;\n          background: white;\n          border-radius: 12px;\n          box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n          padding: 16px;\n          width: 280px;\n          max-height: 400px;\n          overflow-y: auto;\n        }\n        \n        .fb-feedback-item {\n          padding: 12px;\n          background: #F9FAFB;\n          border-radius: 8px;\n          margin-bottom: 8px;\n          font-size: 13px;\n        }\n        \n        .fb-feedback-item-text {\n          color: #374151;\n          margin-bottom: 4px;\n        }\n        \n        .fb-feedback-item-meta {\n          color: #9CA3AF;\n          font-size: 11px;\n        }\n      ",document.head.appendChild(e)},createToggleButton:function(){const e=document.createElement("button");e.className=`fb-widget-button ${this.config.buttonPosition}`,e.textContent="ðŸ’¬ Feedback",e.onclick=()=>this.toggleMode(),document.body.appendChild(e),this.toggleButton=e},toggleMode:function(){this.isActive=!this.isActive,this.toggleButton.classList.toggle("active",this.isActive),this.toggleButton.textContent=this.isActive?"âœ– Cancel":"ðŸ’¬ Feedback",this.isActive?(document.body.style.cursor="crosshair",document.body.style.userSelect="none"):(document.body.style.cursor="",document.body.style.userSelect=""),!this.isActive&&this.currentBox&&this.closeCurrentBox()},setupEventListeners:function(){document.addEventListener("selectstart",e=>{this.isActive&&e.preventDefault()}),document.addEventListener("mousemove",e=>{this.isActive?(document.body.style.cursor="crosshair",document.body.style.userSelect="none",this.isDrawing&&this.currentDrawBox&&this.updateDrawingBox(e.pageX,e.pageY)):(document.body.style.cursor="",document.body.style.userSelect="")}),document.addEventListener("mousedown",e=>{this.isActive&&(e.target.closest(".fb-widget-button")||e.target.closest(".fb-feedback-box")||e.target.closest(".fb-feedback-marker")||(e.preventDefault(),e.stopPropagation(),this.startDrawing(e.pageX,e.pageY)))},!0),document.addEventListener("mouseup",e=>{this.isActive&&this.isDrawing&&(e.preventDefault(),e.stopPropagation(),this.finishDrawing(e.pageX,e.pageY))},!0)},startDrawing:function(e,t){this.isDrawing=!0,this.drawStartX=e,this.drawStartY=t;const n=document.createElement("div");n.className="fb-drawing-box",n.style.left=`${e}px`,n.style.top=`${t}px`,n.style.width="0px",n.style.height="0px",document.body.appendChild(n),this.currentDrawBox=n},updateDrawingBox:function(e,t){if(!this.currentDrawBox)return;const n=Math.min(this.drawStartX,e),o=Math.min(this.drawStartY,t),i=Math.abs(e-this.drawStartX),a=Math.abs(t-this.drawStartY);this.currentDrawBox.style.left=`${n}px`,this.currentDrawBox.style.top=`${o}px`,this.currentDrawBox.style.width=`${i}px`,this.currentDrawBox.style.height=`${a}px`},finishDrawing:function(e,t){this.isDrawing=!1;const n=Math.min(this.drawStartX,e),o=Math.min(this.drawStartY,t),i=Math.abs(e-this.drawStartX),a=Math.abs(t-this.drawStartY);if(i<10||a<10)return this.currentDrawBox&&(this.currentDrawBox.remove(),this.currentDrawBox=null),void this.createFeedbackBox(this.drawStartX,this.drawStartY,100,100);this.createFeedbackBox(n,o,i,a)},createFeedbackBox:function(t,n,o,i){const a=document.createElement("div");a.className="fb-feedback-box",a.style.left=`${Math.min(t+o+10,e.innerWidth-340)}px`,a.style.top=`${Math.min(n,e.innerHeight-250)}px`,a.innerHTML=`\n        <div class="fb-feedback-box-header">\n          <div class="fb-feedback-box-title">Add Feedback</div>\n          <button class="fb-feedback-box-close">Ã—</button>\n        </div>\n        <textarea \n          class="fb-feedback-textarea" \n          placeholder="What's on your mind?"\n          maxlength="${this.config.maxCommentLength}"\n        ></textarea>\n        <div class="fb-feedback-actions">\n          <button class="fb-feedback-btn fb-feedback-btn-secondary">Cancel</button>\n          <button class="fb-feedback-btn fb-feedback-btn-primary">Save</button>\n        </div>\n      `,document.body.appendChild(a),this.currentBox={element:a,x:t,y:n,width:o,height:i};const r=a.querySelector(".fb-feedback-textarea");r.focus(),a.querySelector(".fb-feedback-box-close").onclick=()=>this.cancelFeedback(),a.querySelector(".fb-feedback-btn-secondary").onclick=()=>this.cancelFeedback(),a.querySelector(".fb-feedback-btn-primary").onclick=()=>this.saveFeedback(r.value,t,n,o,i)},cancelFeedback:function(){this.closeCurrentBox(),this.currentDrawBox&&(this.currentDrawBox.remove(),this.currentDrawBox=null)},saveFeedback:function(t,n,o,i,a){if(!t.trim())return void alert("Please enter a comment");const r={id:this.generateId(),comment:t.trim(),position:{x:n,y:o,width:i,height:a,pageX:n,pageY:o,viewportWidth:e.innerWidth,viewportHeight:e.innerHeight,scrollX:e.scrollX,scrollY:e.scrollY},url:e.location.href,pathname:e.location.pathname,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,screenSize:{width:e.screen.width,height:e.screen.height}};this.feedbacks.push(r),this.saveFeedbacks(),this.currentDrawBox&&(this.currentDrawBox.remove(),this.currentDrawBox=null),this.createMarker(r),this.closeCurrentBox(),this.isActive=!1,this.toggleButton.classList.remove("active"),this.toggleButton.textContent="ðŸ’¬ Feedback",document.body.style.cursor="",document.body.style.userSelect="",console.log("Feedback saved:",r)},createMarker:function(e){const t=document.createElement("div");t.className="fb-feedback-marker";const n=this.feedbacks.indexOf(e)+1;t.style.left=`${e.position.pageX}px`,t.style.top=`${e.position.pageY}px`,t.style.width=`${e.position.width}px`,t.style.height=`${e.position.height}px`,t.title=e.comment,t.dataset.feedbackId=e.id;const o=document.createElement("div");o.className="fb-feedback-marker-label",o.textContent=n,t.appendChild(o),t.onclick=t=>{t.stopPropagation(),this.showFeedback(e)},document.body.appendChild(t),console.log("Created marker #"+n+" at:",{left:t.style.left,top:t.style.top,width:t.style.width,height:t.style.height})},showFeedback:function(e){alert(`Feedback #${e.id}\n\n${e.comment}\n\nTime: ${new Date(e.timestamp).toLocaleString()}`)},closeCurrentBox:function(){this.currentBox&&(this.currentBox.element.remove(),this.currentBox=null)},saveFeedbacks:function(){try{localStorage.setItem(this.config.storageKey,JSON.stringify(this.feedbacks))}catch(e){console.error("Failed to save feedbacks:",e)}},loadFeedbacks:function(){try{const e=localStorage.getItem(this.config.storageKey);e&&(this.feedbacks=JSON.parse(e),this.feedbacks.forEach(e=>this.createMarker(e)))}catch(e){console.error("Failed to load feedbacks:",e)}},exportFeedbacks:function(){return JSON.parse(JSON.stringify(this.feedbacks))},importFeedbacks:function(e){this.feedbacks=e,this.saveFeedbacks(),document.querySelectorAll(".fb-feedback-marker").forEach(e=>e.remove()),this.feedbacks.forEach(e=>this.createMarker(e))},clearFeedbacks:function(){confirm("Clear all feedbacks?")&&(this.feedbacks=[],this.saveFeedbacks(),document.querySelectorAll(".fb-feedback-marker").forEach(e=>e.remove()))},generateId:function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}};e.FeedbackWidget=t}(window);